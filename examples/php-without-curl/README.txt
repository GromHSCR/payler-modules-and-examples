Примеры работы Payler Gate API на PHP

Оглавление
1 Справочная информация
2 Предварительные требования
3 Примеры
  3.1 Одностадийный платеж
  3.2 Двухстадийный платеж
  3.3 Загрузка страницы оплаты в iframe
  3.4 Рекуррентные платежи
  3.5 Пользовательская форма оплаты
=====================================

1. Справочная информация

Для тестирования оплаты на своем сайте, обращайтесь в службу поддержки Пэйлер для создания отдельного тестового аккаунта: 24@payler.com, не используйте примеры 

При создании отдельного тестового аккаунта, вам предоставят данные тестовых карт для тестирования оплаты.

Описание API здесь http://payler.com/docs/acquiring_docs
- Payler Gate API
- Статусы транзакции
- Коды ошибок
=====================================

2. Предварительные требования

На сервер нужно установить curl для PHP:

  sudo apt-get install php5-curl
  sudo service apache2 restart

Если вы используете отдельный тестовый аккаунт, в файле settings.php нужно указать платёжный ключ ($key) и пароль ($password) мерчанта. Можно оставить платёжный указанные ключ и пароль.
На тестовом аккаунте после оплаты пользователь возвращается на адрес http://localhost/result.php?order_id={order_id}, если вы создали отдельный тестовый аккаунт, вы можете установить свой обратный URL в настройках аккаунта.
=====================================

3. Примеры

3.1 Пример оплаты одностадийным платежом

Будет создана платёжная сессия и на экране появится кнопка для перехода на страницу ввода карточных данных.

Ввести карточные данные (Обращайтесь в службу поддержки Пэйлер 24@payler.com чтобы получить данные тестовых карт). После оплаты пользователь возвращается в магазин по обратному URL аккаунта.

На экране  появится сообщение: "Заказ <order_id> оплачен/не оплачен" в зависимости от успешности оплаты.
_____________________________________

3.2. Пример оплаты двухстадийным платежом

Будет создана платёжная сессия и на экране появится кнопка для перехода на страницу ввода карточных данных.

Ввести карточные данные (Обращайтесь в службу поддержки Пэйлер 24@payler.com чтобы получить данные тестовых карт). После оплаты пользователь возвращается в магазин по обратному URL аккаунта.

На экране  появится сообщение: "Заказ <order_id> принят/не принят" в зависимости от успешности оплаты. Также появятся 2 кнопки - "Завершить заказ" (метод Charge), "Изменить заказ" (Метод Retrieve). Нажать на любую из них.

Если нажать на "Завершить заказ", деньги будут списаны с карты клиента, статус заказа изменится на Charged. Появится соответствующее сообщение.

Если нажать на кнопку "Изменить заказ", часть суммы (в тестовом примере вся сумма) будет разблокирована на карте клиента, новые сумма и статус заказа будут выведены на экран (в тестовом примере 0 и Reversed)
_____________________________________

3.3 Загрузка страницы оплаты в iframe

ВНИМАНИЕ: по умолчанию на аккаунтах запрещено использование iframe, если вы хотите использовать эту возможность, сообщите об этом службе поддержки при регистрации аккаунта. В тестовом аккаунте, используемом в примере, iframe разрешено.

Будет создана платёжная сессия и на экране в элементе iframe будет загружена страница оплаты Payler.

Ввести карточные данные (Обращайтесь в службу поддержки Пэйлер 24@payler.com чтобы получить данные тестовых карт). После оплаты элемент iframe будет перенаправлен на страницу возврата. 

Если iframe был перенаправлен на несуществующую страницу, значит вы запускаете тестовый пример не с вашего сервера, для тестов вам понадобится создать собственный тестовый аккаунт и в настройках указать обратный URL "http://<адрес тестового сервера>/onestep_result.php?order_id={order_id}". 

На экране  появится сообщение: "Заказ <order_id> оплачен/не оплачен" в зависимости от успешности оплаты.
_____________________________________

3.4 Пример оплаты одностадийным платежом с созданием шаблона для рекуррентных платежей

Будет создана платёжная сессия и на экране появится кнопка для перехода на страницу ввода карточных данных.

Ввести карточные данные (Обращайтесь в службу поддержки Пэйлер 24@payler.com чтобы получить данные тестовых карт).  После оплаты пользователь возвращается в магазин по обратному URL аккаунта.

На экране  появится сообщение: "Заказ <order_id> оплачен/не оплачен" в зависимости от успешности оплаты. Будет выведено сообщение о том, удалось ли создать шаблон рекуррентных платежей на основании платежа.

Если удалось создать шаблон - будет проведен еще один платеж с другой суммой, в случае успеха будет выведена информация о номере нового заказа и сумме.

Если не удалось создать шаблон - будет получена информация по всем шаблонам, и по первому из них будет проведен еще один платеж с другой суммой, в случае успеха будет выведена информация о номере нового заказа и сумме.

Так же, на отдельной странице можно получить список всех шаблонов и провести платеж, указав в поле id необходимого шаблона.
_____________________________________

3.5 Загрузка пользовательской формы оплаты

ВНИМАНИЕ: для использования собственных платежных форм, обратитесь в службу поддержки Пэйлер.

Будет создана платёжная сессия и на экране появится кнопка для перехода на страницу ввода карточных данных.

Будет выведена нестандартная платежная форма, на которой будет добавлено текущее время и текст "PAYLER TEST". Ввести карточные данные (Обращайтесь в службу поддержки Пэйлер 24@payler.com чтобы получить данные тестовых карт).

Действия после оплаты аналогичны одностадийному платежу (3.1)
=======================================

Если у вас возникнут вопросы, можете обратиться в службу поддержки Пэйлер: 24@payler.com

